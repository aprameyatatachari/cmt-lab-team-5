{"ast":null,"code":"import { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class WebsocketService {\n  constructor() {\n    this.socket = null;\n    this.messagesSubject = new Subject();\n    this.connectedSubject = new Subject();\n    this.messages$ = this.messagesSubject.asObservable();\n    this.connected$ = this.connectedSubject.asObservable();\n    this.connect();\n  }\n  connect() {\n    try {\n      this.socket = new WebSocket('ws://localhost:8080');\n      this.socket.onopen = () => {\n        console.log('âœ… Connected to Order Service WebSocket');\n        this.connectedSubject.next(true);\n      };\n      this.socket.onmessage = event => {\n        try {\n          const order = JSON.parse(event.data);\n          // Add timestamp if not provided by backend\n          if (!order.timestamp) {\n            order.timestamp = Date.now();\n          }\n          console.log('ðŸ“¦ Received order:', order);\n          this.messagesSubject.next(order);\n        } catch (error) {\n          console.error('Error parsing message:', error);\n        }\n      };\n      this.socket.onclose = () => {\n        console.log('âŒ Disconnected from Order Service');\n        this.connectedSubject.next(false);\n        // Attempt reconnection after 3 seconds\n        setTimeout(() => this.connect(), 3000);\n      };\n      this.socket.onerror = error => {\n        console.error('WebSocket error:', error);\n        this.connectedSubject.next(false);\n      };\n    } catch (error) {\n      console.error('Failed to connect:', error);\n      this.connectedSubject.next(false);\n    }\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n  static {\n    this.Éµfac = function WebsocketService_Factory(t) {\n      return new (t || WebsocketService)();\n    };\n  }\n  static {\n    this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: WebsocketService,\n      factory: WebsocketService.Éµfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["Subject","WebsocketService","constructor","socket","messagesSubject","connectedSubject","messages$","asObservable","connected$","connect","WebSocket","onopen","console","log","next","onmessage","event","order","JSON","parse","data","timestamp","Date","now","error","onclose","setTimeout","onerror","disconnect","close","factory","Éµfac","providedIn"],"sources":["C:\\Users\\hp\\Documents\\GitHub\\cmt-lab-team-5\\ui\\src\\app\\services\\websocket.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Subject, Observable } from 'rxjs';\r\n\r\nexport interface Order {\r\n  clOrdID: string;\r\n  symbol: string;\r\n  side: string;\r\n  price: number;\r\n  quantity: number;\r\n  cumQty: number;\r\n  ordStatus: string;\r\n  isNew?: boolean;\r\n  timestamp?: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WebsocketService {\r\n  private socket: WebSocket | null = null;\r\n  private messagesSubject = new Subject<Order>();\r\n  private connectedSubject = new Subject<boolean>();\r\n\r\n  public messages$: Observable<Order> = this.messagesSubject.asObservable();\r\n  public connected$: Observable<boolean> = this.connectedSubject.asObservable();\r\n\r\n  constructor() {\r\n    this.connect();\r\n  }\r\n\r\n  private connect(): void {\r\n    try {\r\n      this.socket = new WebSocket('ws://localhost:8080');\r\n\r\n      this.socket.onopen = () => {\r\n        console.log('âœ… Connected to Order Service WebSocket');\r\n        this.connectedSubject.next(true);\r\n      };\r\n\r\n      this.socket.onmessage = (event) => {\r\n        try {\r\n          const order: Order = JSON.parse(event.data);\r\n          // Add timestamp if not provided by backend\r\n          if (!order.timestamp) {\r\n            order.timestamp = Date.now();\r\n          }\r\n          console.log('ðŸ“¦ Received order:', order);\r\n          this.messagesSubject.next(order);\r\n        } catch (error) {\r\n          console.error('Error parsing message:', error);\r\n        }\r\n      };\r\n\r\n      this.socket.onclose = () => {\r\n        console.log('âŒ Disconnected from Order Service');\r\n        this.connectedSubject.next(false);\r\n        // Attempt reconnection after 3 seconds\r\n        setTimeout(() => this.connect(), 3000);\r\n      };\r\n\r\n      this.socket.onerror = (error) => {\r\n        console.error('WebSocket error:', error);\r\n        this.connectedSubject.next(false);\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to connect:', error);\r\n      this.connectedSubject.next(false);\r\n    }\r\n  }\r\n\r\n  public disconnect(): void {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n  }\r\n}\r\n"],"mappings":"AACA,SAASA,OAAO,QAAoB,MAAM;;AAiB1C,OAAM,MAAOC,gBAAgB;EAQ3BC,YAAA;IAPQ,KAAAC,MAAM,GAAqB,IAAI;IAC/B,KAAAC,eAAe,GAAG,IAAIJ,OAAO,EAAS;IACtC,KAAAK,gBAAgB,GAAG,IAAIL,OAAO,EAAW;IAE1C,KAAAM,SAAS,GAAsB,IAAI,CAACF,eAAe,CAACG,YAAY,EAAE;IAClE,KAAAC,UAAU,GAAwB,IAAI,CAACH,gBAAgB,CAACE,YAAY,EAAE;IAG3E,IAAI,CAACE,OAAO,EAAE;EAChB;EAEQA,OAAOA,CAAA;IACb,IAAI;MACF,IAAI,CAACN,MAAM,GAAG,IAAIO,SAAS,CAAC,qBAAqB,CAAC;MAElD,IAAI,CAACP,MAAM,CAACQ,MAAM,GAAG,MAAK;QACxBC,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;QACrD,IAAI,CAACR,gBAAgB,CAACS,IAAI,CAAC,IAAI,CAAC;MAClC,CAAC;MAED,IAAI,CAACX,MAAM,CAACY,SAAS,GAAIC,KAAK,IAAI;QAChC,IAAI;UACF,MAAMC,KAAK,GAAUC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;UAC3C;UACA,IAAI,CAACH,KAAK,CAACI,SAAS,EAAE;YACpBJ,KAAK,CAACI,SAAS,GAAGC,IAAI,CAACC,GAAG,EAAE;;UAE9BX,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEI,KAAK,CAAC;UACxC,IAAI,CAACb,eAAe,CAACU,IAAI,CAACG,KAAK,CAAC;SACjC,CAAC,OAAOO,KAAK,EAAE;UACdZ,OAAO,CAACY,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;;MAElD,CAAC;MAED,IAAI,CAACrB,MAAM,CAACsB,OAAO,GAAG,MAAK;QACzBb,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC;QAChD,IAAI,CAACR,gBAAgB,CAACS,IAAI,CAAC,KAAK,CAAC;QACjC;QACAY,UAAU,CAAC,MAAM,IAAI,CAACjB,OAAO,EAAE,EAAE,IAAI,CAAC;MACxC,CAAC;MAED,IAAI,CAACN,MAAM,CAACwB,OAAO,GAAIH,KAAK,IAAI;QAC9BZ,OAAO,CAACY,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;QACxC,IAAI,CAACnB,gBAAgB,CAACS,IAAI,CAAC,KAAK,CAAC;MACnC,CAAC;KACF,CAAC,OAAOU,KAAK,EAAE;MACdZ,OAAO,CAACY,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;MAC1C,IAAI,CAACnB,gBAAgB,CAACS,IAAI,CAAC,KAAK,CAAC;;EAErC;EAEOc,UAAUA,CAAA;IACf,IAAI,IAAI,CAACzB,MAAM,EAAE;MACf,IAAI,CAACA,MAAM,CAAC0B,KAAK,EAAE;MACnB,IAAI,CAAC1B,MAAM,GAAG,IAAI;;EAEtB;;;uBAzDWF,gBAAgB;IAAA;EAAA;;;aAAhBA,gBAAgB;MAAA6B,OAAA,EAAhB7B,gBAAgB,CAAA8B,IAAA;MAAAC,UAAA,EAFf;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}